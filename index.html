<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pong</title>
    <link rel="stylesheet" href="estilos/style.css">
</head>
    <body>
        <header>
            <h1>Ping Pong</h1>
        </header>

        <section>
            <div>
                <canvas id="folha" width="600" height="500"></canvas>
            </div>
        </section>
        
        <footer>
            <p>Desenvolvido com &#128151 </p>
        </footer>

        <script>
            // carrega os primeiros comandos
            window.onload = function() {
                iniciar() // Inicializa os comandos e variaveis

                setInterval(principal, 1000 / 30) // Roda o nosso jogo dentro
            }

            function iniciar() {
                folhaDesenho = document.getElementById("folha")
                areaDesenho = folhaDesenho.getContext("2d")

                larguraCampo = 600
                alturaCampo = 500
                espessuraRede = 5

                diametroBola = 10

                espessuraRaquete = 11
                alturaRaquete = 100

                efeitoRaquete = 0.3
                velocidadeJogador2 = 5

                posicaoJogador1 = posicaoJogador2 = 40
                posicaoBolaX = posicaoBolaY = 10
                velocidadeBolaPosicaoX = velocidadeBolaPosicaoY = 5
                pontuacaoJogador1 = pontuacaoJogador2 = 0

                folhaDesenho.addEventListener('mousemove', function(e){
                    posicaoJogador1 = e.clientY - alturaRaquete / 2
                })
            }

            function principal() {
                desenhar()
                calcular()
            }

            function desenhar() {
                areaDesenho.fillStyle = "#181818" //cor verde
                areaDesenho.fillRect(
                    0,
                    0,
                    larguraCampo,
                    alturaCampo
                )

                areaDesenho.fillStyle = "#FFFFFF"
                
                areaDesenho.fillRect(
                    larguraCampo / 2 - espessuraRede / 2,
                    0,
                    espessuraRede,
                    alturaCampo
                )

                areaDesenho.fillRect(
                    posicaoBolaX - diametroBola / 2, 
                    posicaoBolaY - diametroBola / 2,
                    diametroBola,
                    diametroBola
                )

                // Escrever a pontuação do jogador
                areaDesenho.fillText(
                    "Humano - " + pontuacaoJogador1 + " pontos",
                    100,
                    100
                )
                areaDesenho.fillText(
                    "Computador - " + pontuacaoJogador2 + " pontos",
                    larguraCampo - 200,
                    100
                )

                // Raquetes
                areaDesenho.fillRect(
                    0,
                    posicaoJogador1,
                    espessuraRaquete,
                    alturaRaquete
                )
                areaDesenho.fillRect(
                    larguraCampo - espessuraRaquete,
                    posicaoJogador2,
                    espessuraRaquete,
                    alturaRaquete
                ) 
            }

            function calcular() {
                desenhar()

                posicaoBolaX = posicaoBolaX + velocidadeBolaPosicaoX
                posicaoBolaY = posicaoBolaY + velocidadeBolaPosicaoY

                // Verifica canto superior
                if(posicaoBolaY < 0 && velocidadeBolaPosicaoY < 0) {
                    velocidadeBolaPosicaoY = -velocidadeBolaPosicaoY
                }
                // Verifica canto inferior
                if(posicaoBolaY > alturaCampo && velocidadeBolaPosicaoY > 0) {
                    velocidadeBolaPosicaoY = -velocidadeBolaPosicaoY
                }

                // Verifica se o Jogador 2 fez um ponto
                if(posicaoBolaX < 0) {
                    if(
                        posicaoBolaY > posicaoJogador1 &&
                        posicaoBolaY < posicaoJogador1 + alturaRaquete
                        ) {
                        // Rebater a bola
                        velocidadeBolaPosicaoX = -velocidadeBolaPosicaoX

                        let diferencaY =
                            posicaoBolaY - (posicaoJogador1 + alturaRaquete / 2)
                        velocidadeBolaPosicaoY = diferencaY * efeitoRaquete
                    } else {
                        // Pontos do jogador 2
                        pontuacaoJogador2++

                        // Colocar a bola no centro
                        continuar()
                    }
                }
                // Verifica se o Jogador 1 fez ponto
                if(posicaoBolaX > larguraCampo) {
                    if(
                        posicaoBolaY > posicaoJogador2 &&
                        posicaoBolaY < posicaoJogador2 + alturaRaquete
                        ) {
                        // Rebater a bola
                        velocidadeBolaPosicaoX = -velocidadeBolaPosicaoX

                        let diferencaY = 
                            posicaoBolaY - (posicaoJogador2 + alturaRaquete / 2) 
                        velocidadeBolaPosicaoY = diferencaY * efeitoRaquete
                    } else {
                        // Pontos do jogador 1
                        pontuacaoJogador1++
                        // Colocar a bola no centro
                        continuar()
                    }
                }
                // Atualiza a posição do Jogador 2
                if(posicaoJogador2 + alturaRaquete / 2 < posicaoBolaY) {
                    posicaoJogador2 = posicaoJogador2 + velocidadeJogador2
                } else {
                    posicaoJogador2 = posicaoJogador2 - velocidadeJogador2
                }
            }
    
            function continuar() {
                // colocar a bola no centro
                posicaoBolaX = larguraCampo / 2
                posicaoBolaY = alturaCampo / 2
                velocidadeBolaPosicaoX = -velocidadeBolaPosicaoX
                velocidadeBolaPosicaoY = 3
            }
    </script>
    </body>
</html>